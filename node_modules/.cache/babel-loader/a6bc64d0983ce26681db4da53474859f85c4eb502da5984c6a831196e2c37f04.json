{"ast":null,"code":"// FileName: HandleAuth.tsx\nimport React,{createContext,useState,useEffect,useCallback,useContext}from'react';import CryptoJS from'crypto-js';import{jsx as _jsx}from\"react/jsx-runtime\";const secretKey='a0c2b1ab664e5ea5ca735d57f4cdaaf8';const HandleAuthContext=/*#__PURE__*/createContext(undefined);export const HandleAuthProvider=_ref=>{let{children}=_ref;const[userID,setUserID]=useState(localStorage.getItem('userID'));const[error,setError]=useState(null);const encrypt=useCallback(text=>CryptoJS.AES.encrypt(text,secretKey).toString(),[]);const decrypt=useCallback(ciphertext=>{const bytes=CryptoJS.AES.decrypt(ciphertext,secretKey);return bytes.toString(CryptoJS.enc.Utf8);},[]);const setAuth=useCallback(token=>{const encryptedToken=encrypt(token);sessionStorage.setItem('authToken',encryptedToken);fetchUserName();},[encrypt]);const getAuth=useCallback(()=>userID,[userID]);const fetchUserName=useCallback(async()=>{const encryptedToken=sessionStorage.getItem('authToken');const token=encryptedToken?decrypt(encryptedToken):null;const apiKey='053905e1fc8b0de378dc341a24ec68c7';if(token){const paramsString=\"api_key=\".concat(apiKey,\"&token=\").concat(token);const apiSig=CryptoJS.MD5(paramsString+secretKey).toString();const url=\"https://ws.audioscrobbler.com/2.0/?method=auth.getSession&token=\".concat(token,\"&api_key=\").concat(apiKey,\"&api_sig=\").concat(apiSig,\"&format=json\");try{const response=await fetch(url);if(!response.ok){throw new Error(\"HTTP error! status: \".concat(response.status));}const data=await response.json();if(data.session&&data.session.name){setUserID(data.session.name);localStorage.setItem('userID',data.session.name);sessionStorage.setItem('userID',data.session.name);}}catch(error){setError(error instanceof Error?error.message:String(error));}}},[decrypt,setUserID,setError]);useEffect(()=>{if(!userID){fetchUserName();}},[userID,fetchUserName]);return/*#__PURE__*/_jsx(HandleAuthContext.Provider,{value:{userID,error,getAuth,setAuth,checkAndModifyDOMBasedOnUser:()=>{}},children:children});};export const useHandleAuth=()=>{const context=useContext(HandleAuthContext);if(context===undefined){throw new Error('useHandleAuth must be used within a HandleAuthProvider');}return context;};","map":{"version":3,"names":["React","createContext","useState","useEffect","useCallback","useContext","CryptoJS","jsx","_jsx","secretKey","HandleAuthContext","undefined","HandleAuthProvider","_ref","children","userID","setUserID","localStorage","getItem","error","setError","encrypt","text","AES","toString","decrypt","ciphertext","bytes","enc","Utf8","setAuth","token","encryptedToken","sessionStorage","setItem","fetchUserName","getAuth","apiKey","paramsString","concat","apiSig","MD5","url","response","fetch","ok","Error","status","data","json","session","name","message","String","Provider","value","checkAndModifyDOMBasedOnUser","useHandleAuth","context"],"sources":["C:/Users/jules/source/repos/jaykang98/jaze/src/utils/HandleAuth.tsx"],"sourcesContent":["// FileName: HandleAuth.tsx\r\nimport React, { createContext, useState, useEffect, useCallback, useContext } from 'react';\r\nimport CryptoJS from 'crypto-js';\r\n\r\nconst secretKey = 'a0c2b1ab664e5ea5ca735d57f4cdaaf8';\r\n\r\nconst HandleAuthContext = createContext<{\r\n    userID: string | null;\r\n    error: string | null;\r\n    getAuth: () => string | null;\r\n    setAuth: (token: string) => void;\r\n    checkAndModifyDOMBasedOnUser: () => void;\r\n} | undefined>(undefined);\r\n\r\nexport const HandleAuthProvider = ({ children }: { children: React.ReactNode }) => {\r\n    const [userID, setUserID] = useState<string | null>(localStorage.getItem('userID'));\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const encrypt = useCallback((text: string): string => CryptoJS.AES.encrypt(text, secretKey).toString(), []);\r\n\r\n    const decrypt = useCallback((ciphertext: string): string => {\r\n        const bytes = CryptoJS.AES.decrypt(ciphertext, secretKey);\r\n        return bytes.toString(CryptoJS.enc.Utf8);\r\n    }, []);\r\n\r\n    const setAuth = useCallback((token: string) => {\r\n        const encryptedToken = encrypt(token);\r\n        sessionStorage.setItem('authToken', encryptedToken);\r\n        fetchUserName();\r\n    }, [encrypt]);\r\n\r\n    const getAuth = useCallback(() => userID, [userID]);\r\n\r\n    const fetchUserName = useCallback(async () => {\r\n        const encryptedToken = sessionStorage.getItem('authToken');\r\n        const token = encryptedToken ? decrypt(encryptedToken) : null;\r\n        const apiKey = '053905e1fc8b0de378dc341a24ec68c7';\r\n\r\n        if (token) {\r\n            const paramsString = `api_key=${apiKey}&token=${token}`;\r\n            const apiSig = CryptoJS.MD5(paramsString + secretKey).toString();\r\n            const url = `https://ws.audioscrobbler.com/2.0/?method=auth.getSession&token=${token}&api_key=${apiKey}&api_sig=${apiSig}&format=json`;\r\n\r\n            try {\r\n                const response = await fetch(url);\r\n                if (!response.ok) {\r\n                    throw new Error(`HTTP error! status: ${response.status}`);\r\n                }\r\n                const data = await response.json();\r\n\r\n                if (data.session && data.session.name) {\r\n                    setUserID(data.session.name);\r\n                    localStorage.setItem('userID', data.session.name);\r\n                    sessionStorage.setItem('userID', data.session.name);\r\n                }\r\n            } catch (error) {\r\n                setError(error instanceof Error ? error.message : String(error));\r\n            }\r\n        }\r\n    }, [decrypt, setUserID, setError]);\r\n\r\n    useEffect(() => {\r\n        if (!userID) {\r\n            fetchUserName();\r\n        }\r\n    }, [userID, fetchUserName]);\r\n\r\n    return (\r\n        <HandleAuthContext.Provider value={{ userID, error, getAuth, setAuth, checkAndModifyDOMBasedOnUser: () => { } }}>\r\n            {children}\r\n        </HandleAuthContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useHandleAuth = () => {\r\n    const context = useContext(HandleAuthContext);\r\n    if (context === undefined) {\r\n        throw new Error('useHandleAuth must be used within a HandleAuthProvider');\r\n    }\r\n    return context;\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}