{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport { decrypt } from './Encryption'; // Ensure this path is correct\nimport CryptoJS from 'crypto-js';\n\n// Custom hook for handling authentication\nconst HandleAuth = () => {\n  _s();\n  const [userID, setUserID] = useState(localStorage.getItem('userID') || null);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    const fetchUserName = async () => {\n      if (userID) return;\n      const encryptedToken = sessionStorage.getItem('authToken');\n      const token = encryptedToken ? decrypt(encryptedToken) : null;\n      const apiKey = '053905e1fc8b0de378dc341a24ec68c7';\n      const secret = 'a0c2b1ab664e5ea5ca735d57f4cdaaf8';\n      const paramsString = `api_key${apiKey}methodauth.getSessiontoken${token}${secret}`;\n      const apiSig = CryptoJS.MD5(paramsString).toString();\n      if (token) {\n        const url = `https://ws.audioscrobbler.com/2.0/?method=auth.getSession&token=${token}&api_key=${apiKey}&api_sig=${apiSig}&format=json`;\n        try {\n          const response = await fetch(url);\n          if (!response.ok) {\n            throw new Error(`HTTP error! status: ${response.status}`);\n          }\n          const data = await response.json();\n          if (data.session && data.session.name) {\n            setUserID(data.session.name);\n            localStorage.setItem('userID', data.session.name);\n          }\n        } catch (error) {\n          console.error(\"Failed to fetch session:\", error);\n          setError(error);\n        }\n      }\n    };\n    fetchUserName();\n  }, [userID]); // Dependency array to prevent re-fetching if userID is already set\n\n  return {\n    userID,\n    error\n  };\n};\n_s(HandleAuth, \"5EMGEJU5SaPvNDHeyekzP9+F6Uk=\");\n_c = HandleAuth;\nexport default HandleAuth;\nvar _c;\n$RefreshReg$(_c, \"HandleAuth\");","map":{"version":3,"names":["useState","useEffect","decrypt","CryptoJS","HandleAuth","_s","userID","setUserID","localStorage","getItem","error","setError","fetchUserName","encryptedToken","sessionStorage","token","apiKey","secret","paramsString","apiSig","MD5","toString","url","response","fetch","ok","Error","status","data","json","session","name","setItem","console","_c","$RefreshReg$"],"sources":["C:/Users/jules/source/repos/jaykang98/jaze/src/utils/HandleAuth.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { decrypt } from './Encryption'; // Ensure this path is correct\r\nimport CryptoJS from 'crypto-js';\r\n\r\n// Custom hook for handling authentication\r\nconst HandleAuth = () => {\r\n    const [userID, setUserID] = useState(localStorage.getItem('userID') || null);\r\n    const [error, setError] = useState(null);\r\n\r\n    useEffect(() => {\r\n        const fetchUserName = async () => {\r\n            if (userID) return;\r\n\r\n            const encryptedToken = sessionStorage.getItem('authToken');\r\n            const token = encryptedToken ? decrypt(encryptedToken) : null;\r\n            const apiKey = '053905e1fc8b0de378dc341a24ec68c7';\r\n            const secret = 'a0c2b1ab664e5ea5ca735d57f4cdaaf8';\r\n\r\n            const paramsString = `api_key${apiKey}methodauth.getSessiontoken${token}${secret}`;\r\n            const apiSig = CryptoJS.MD5(paramsString).toString();\r\n\r\n            if (token) {\r\n                const url = `https://ws.audioscrobbler.com/2.0/?method=auth.getSession&token=${token}&api_key=${apiKey}&api_sig=${apiSig}&format=json`;\r\n\r\n                try {\r\n                    const response = await fetch(url);\r\n                    if (!response.ok) {\r\n                        throw new Error(`HTTP error! status: ${response.status}`);\r\n                    }\r\n                    const data = await response.json();\r\n\r\n                    if (data.session && data.session.name) {\r\n                        setUserID(data.session.name);\r\n                        localStorage.setItem('userID', data.session.name);\r\n                    }\r\n                } catch (error) {\r\n                    console.error(\"Failed to fetch session:\", error);\r\n                    setError(error);\r\n                }\r\n            }\r\n        };\r\n\r\n        fetchUserName();\r\n    }, [userID]); // Dependency array to prevent re-fetching if userID is already set\r\n\r\n    return { userID, error };\r\n};\r\n\r\nexport default HandleAuth;\r\n\r\n"],"mappings":";AAAA,SAASA,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAC3C,SAASC,OAAO,QAAQ,cAAc,CAAC,CAAC;AACxC,OAAOC,QAAQ,MAAM,WAAW;;AAEhC;AACA,MAAMC,UAAU,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACrB,MAAM,CAACC,MAAM,EAAEC,SAAS,CAAC,GAAGP,QAAQ,CAACQ,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC;EAC5E,MAAM,CAACC,KAAK,EAAEC,QAAQ,CAAC,GAAGX,QAAQ,CAAC,IAAI,CAAC;EAExCC,SAAS,CAAC,MAAM;IACZ,MAAMW,aAAa,GAAG,MAAAA,CAAA,KAAY;MAC9B,IAAIN,MAAM,EAAE;MAEZ,MAAMO,cAAc,GAAGC,cAAc,CAACL,OAAO,CAAC,WAAW,CAAC;MAC1D,MAAMM,KAAK,GAAGF,cAAc,GAAGX,OAAO,CAACW,cAAc,CAAC,GAAG,IAAI;MAC7D,MAAMG,MAAM,GAAG,kCAAkC;MACjD,MAAMC,MAAM,GAAG,kCAAkC;MAEjD,MAAMC,YAAY,GAAI,UAASF,MAAO,6BAA4BD,KAAM,GAAEE,MAAO,EAAC;MAClF,MAAME,MAAM,GAAGhB,QAAQ,CAACiB,GAAG,CAACF,YAAY,CAAC,CAACG,QAAQ,CAAC,CAAC;MAEpD,IAAIN,KAAK,EAAE;QACP,MAAMO,GAAG,GAAI,mEAAkEP,KAAM,YAAWC,MAAO,YAAWG,MAAO,cAAa;QAEtI,IAAI;UACA,MAAMI,QAAQ,GAAG,MAAMC,KAAK,CAACF,GAAG,CAAC;UACjC,IAAI,CAACC,QAAQ,CAACE,EAAE,EAAE;YACd,MAAM,IAAIC,KAAK,CAAE,uBAAsBH,QAAQ,CAACI,MAAO,EAAC,CAAC;UAC7D;UACA,MAAMC,IAAI,GAAG,MAAML,QAAQ,CAACM,IAAI,CAAC,CAAC;UAElC,IAAID,IAAI,CAACE,OAAO,IAAIF,IAAI,CAACE,OAAO,CAACC,IAAI,EAAE;YACnCxB,SAAS,CAACqB,IAAI,CAACE,OAAO,CAACC,IAAI,CAAC;YAC5BvB,YAAY,CAACwB,OAAO,CAAC,QAAQ,EAAEJ,IAAI,CAACE,OAAO,CAACC,IAAI,CAAC;UACrD;QACJ,CAAC,CAAC,OAAOrB,KAAK,EAAE;UACZuB,OAAO,CAACvB,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;UAChDC,QAAQ,CAACD,KAAK,CAAC;QACnB;MACJ;IACJ,CAAC;IAEDE,aAAa,CAAC,CAAC;EACnB,CAAC,EAAE,CAACN,MAAM,CAAC,CAAC,CAAC,CAAC;;EAEd,OAAO;IAAEA,MAAM;IAAEI;EAAM,CAAC;AAC5B,CAAC;AAACL,EAAA,CAzCID,UAAU;AAAA8B,EAAA,GAAV9B,UAAU;AA2ChB,eAAeA,UAAU;AAAC,IAAA8B,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}