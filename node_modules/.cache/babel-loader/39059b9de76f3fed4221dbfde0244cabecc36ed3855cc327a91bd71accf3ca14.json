{"ast":null,"code":"import{useState,useEffect}from'react';import CryptoJS from'crypto-js';const secretKey='a0c2b1ab664e5ea5ca735d57f4cdaaf8';export const encrypt=text=>{return CryptoJS.AES.encrypt(text,secretKey).toString();};export const decrypt=ciphertext=>{const bytes=CryptoJS.AES.decrypt(ciphertext,secretKey);return bytes.toString(CryptoJS.enc.Utf8);};// Custom hook for handling authentication\nconst HandleAuth=()=>{const[userID,setUserID]=useState(localStorage.getItem('userID'));const[error,setError]=useState(null);useEffect(()=>{const fetchUserName=async()=>{if(userID)return;const encryptedToken=sessionStorage.getItem('authToken');const token=encryptedToken?decrypt(encryptedToken):null;const apiKey='053905e1fc8b0de378dc341a24ec68c7';if(token){const paramsString=\"api_key=\".concat(apiKey,\"&token=\").concat(token);const apiSig=CryptoJS.MD5(paramsString+secretKey).toString();const url=\"https://ws.audioscrobbler.com/2.0/?method=auth.getSession&token=\".concat(token,\"&api_key=\").concat(apiKey,\"&api_sig=\").concat(apiSig,\"&format=json\");try{const response=await fetch(url);if(!response.ok){throw new Error(\"HTTP error! status: \".concat(response.status));}const data=await response.json();if(data.session&&data.session.name){setUserID(data.session.name);localStorage.setItem('userID',data.session.name);// Corrected method name\n}}catch(error){console.error(\"Failed to fetch session:\",error);setError(error instanceof Error?error.message:String(error));}}};fetchUserName();},[userID]);// Dependency array to prevent re-fetching if userID is already set\nreturn{userID,error};};export default HandleAuth;","map":{"version":3,"names":["useState","useEffect","CryptoJS","secretKey","encrypt","text","AES","toString","decrypt","ciphertext","bytes","enc","Utf8","HandleAuth","userID","setUserID","localStorage","getItem","error","setError","fetchUserName","encryptedToken","sessionStorage","token","apiKey","paramsString","concat","apiSig","MD5","url","response","fetch","ok","Error","status","data","json","session","name","setItem","console","message","String"],"sources":["C:/Users/jules/source/repos/jaykang98/jaze/src/utils/HandleAuth.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport CryptoJS from 'crypto-js';\r\n\r\nconst secretKey = 'a0c2b1ab664e5ea5ca735d57f4cdaaf8';\r\n\r\nexport const encrypt = (text: string): string => {\r\n    return CryptoJS.AES.encrypt(text, secretKey).toString();\r\n};\r\n\r\nexport const decrypt = (ciphertext: string): string => {\r\n    const bytes = CryptoJS.AES.decrypt(ciphertext, secretKey);\r\n    return bytes.toString(CryptoJS.enc.Utf8);\r\n};\r\n\r\n// Custom hook for handling authentication\r\nconst HandleAuth = () => {\r\n    const [userID, setUserID] = useState<string | null>(localStorage.getItem('userID'));\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        const fetchUserName = async () => {\r\n            if (userID) return;\r\n\r\n            const encryptedToken = sessionStorage.getItem('authToken');\r\n            const token = encryptedToken ? decrypt(encryptedToken) : null;\r\n            const apiKey = '053905e1fc8b0de378dc341a24ec68c7';\r\n\r\n            if (token) {\r\n                const paramsString = `api_key=${apiKey}&token=${token}`;\r\n                const apiSig = CryptoJS.MD5(paramsString + secretKey).toString();\r\n                const url = `https://ws.audioscrobbler.com/2.0/?method=auth.getSession&token=${token}&api_key=${apiKey}&api_sig=${apiSig}&format=json`;\r\n\r\n                try {\r\n                    const response = await fetch(url);\r\n                    if (!response.ok) {\r\n                        throw new Error(`HTTP error! status: ${response.status}`);\r\n                    }\r\n                    const data = await response.json();\r\n\r\n                    if (data.session && data.session.name) {\r\n                        setUserID(data.session.name);\r\n                        localStorage.setItem('userID', data.session.name); // Corrected method name\r\n                    }\r\n                } catch (error) {\r\n                    console.error(\"Failed to fetch session:\", error);\r\n                    setError(error instanceof Error ? error.message : String(error));\r\n                }\r\n            }\r\n        };\r\n\r\n        fetchUserName();\r\n    }, [userID]); // Dependency array to prevent re-fetching if userID is already set\r\n\r\n    return { userID, error };\r\n};\r\n\r\nexport default HandleAuth;\r\n"],"mappings":"AAAA,OAASA,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC3C,MAAO,CAAAC,QAAQ,KAAM,WAAW,CAEhC,KAAM,CAAAC,SAAS,CAAG,kCAAkC,CAEpD,MAAO,MAAM,CAAAC,OAAO,CAAIC,IAAY,EAAa,CAC7C,MAAO,CAAAH,QAAQ,CAACI,GAAG,CAACF,OAAO,CAACC,IAAI,CAAEF,SAAS,CAAC,CAACI,QAAQ,CAAC,CAAC,CAC3D,CAAC,CAED,MAAO,MAAM,CAAAC,OAAO,CAAIC,UAAkB,EAAa,CACnD,KAAM,CAAAC,KAAK,CAAGR,QAAQ,CAACI,GAAG,CAACE,OAAO,CAACC,UAAU,CAAEN,SAAS,CAAC,CACzD,MAAO,CAAAO,KAAK,CAACH,QAAQ,CAACL,QAAQ,CAACS,GAAG,CAACC,IAAI,CAAC,CAC5C,CAAC,CAED;AACA,KAAM,CAAAC,UAAU,CAAGA,CAAA,GAAM,CACrB,KAAM,CAACC,MAAM,CAAEC,SAAS,CAAC,CAAGf,QAAQ,CAAgBgB,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,CAAC,CACnF,KAAM,CAACC,KAAK,CAAEC,QAAQ,CAAC,CAAGnB,QAAQ,CAAgB,IAAI,CAAC,CAEvDC,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAmB,aAAa,CAAG,KAAAA,CAAA,GAAY,CAC9B,GAAIN,MAAM,CAAE,OAEZ,KAAM,CAAAO,cAAc,CAAGC,cAAc,CAACL,OAAO,CAAC,WAAW,CAAC,CAC1D,KAAM,CAAAM,KAAK,CAAGF,cAAc,CAAGb,OAAO,CAACa,cAAc,CAAC,CAAG,IAAI,CAC7D,KAAM,CAAAG,MAAM,CAAG,kCAAkC,CAEjD,GAAID,KAAK,CAAE,CACP,KAAM,CAAAE,YAAY,YAAAC,MAAA,CAAcF,MAAM,YAAAE,MAAA,CAAUH,KAAK,CAAE,CACvD,KAAM,CAAAI,MAAM,CAAGzB,QAAQ,CAAC0B,GAAG,CAACH,YAAY,CAAGtB,SAAS,CAAC,CAACI,QAAQ,CAAC,CAAC,CAChE,KAAM,CAAAsB,GAAG,oEAAAH,MAAA,CAAsEH,KAAK,cAAAG,MAAA,CAAYF,MAAM,cAAAE,MAAA,CAAYC,MAAM,gBAAc,CAEtI,GAAI,CACA,KAAM,CAAAG,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAACF,GAAG,CAAC,CACjC,GAAI,CAACC,QAAQ,CAACE,EAAE,CAAE,CACd,KAAM,IAAI,CAAAC,KAAK,wBAAAP,MAAA,CAAwBI,QAAQ,CAACI,MAAM,CAAE,CAAC,CAC7D,CACA,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAL,QAAQ,CAACM,IAAI,CAAC,CAAC,CAElC,GAAID,IAAI,CAACE,OAAO,EAAIF,IAAI,CAACE,OAAO,CAACC,IAAI,CAAE,CACnCvB,SAAS,CAACoB,IAAI,CAACE,OAAO,CAACC,IAAI,CAAC,CAC5BtB,YAAY,CAACuB,OAAO,CAAC,QAAQ,CAAEJ,IAAI,CAACE,OAAO,CAACC,IAAI,CAAC,CAAE;AACvD,CACJ,CAAE,MAAOpB,KAAK,CAAE,CACZsB,OAAO,CAACtB,KAAK,CAAC,0BAA0B,CAAEA,KAAK,CAAC,CAChDC,QAAQ,CAACD,KAAK,WAAY,CAAAe,KAAK,CAAGf,KAAK,CAACuB,OAAO,CAAGC,MAAM,CAACxB,KAAK,CAAC,CAAC,CACpE,CACJ,CACJ,CAAC,CAEDE,aAAa,CAAC,CAAC,CACnB,CAAC,CAAE,CAACN,MAAM,CAAC,CAAC,CAAE;AAEd,MAAO,CAAEA,MAAM,CAAEI,KAAM,CAAC,CAC5B,CAAC,CAED,cAAe,CAAAL,UAAU"},"metadata":{},"sourceType":"module","externalDependencies":[]}