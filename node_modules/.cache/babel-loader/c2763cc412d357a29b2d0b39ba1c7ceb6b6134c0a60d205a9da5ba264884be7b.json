{"ast":null,"code":"import{useState,useEffect}from'react';import{decrypt}from'./Encryption';// Ensure this path is correct\nimport CryptoJS from'crypto-js';// Custom hook for handling authentication\nconst HandleAuth=()=>{const[userID,setUserID]=useState(localStorage.getItem('userID')||null);const[error,setError]=useState(null);useEffect(()=>{const fetchUserName=async()=>{if(userID)return;const encryptedToken=sessionStorage.getItem('authToken');const token=encryptedToken?decrypt(encryptedToken):null;const apiKey='053905e1fc8b0de378dc341a24ec68c7';const secret='a0c2b1ab664e5ea5ca735d57f4cdaaf8';const paramsString=\"api_key\".concat(apiKey,\"methodauth.getSessiontoken\").concat(token).concat(secret);const apiSig=CryptoJS.MD5(paramsString).toString();if(token){const url=\"https://ws.audioscrobbler.com/2.0/?method=auth.getSession&token=\".concat(token,\"&api_key=\").concat(apiKey,\"&api_sig=\").concat(apiSig,\"&format=json\");try{const response=await fetch(url);if(!response.ok){throw new Error(\"HTTP error! status: \".concat(response.status));}const data=await response.json();if(data.session&&data.session.name){setUserID(data.session.name);localStorage.set(userID,data.session.name);}}catch(error){console.error(\"Failed to fetch session:\",error);setError(error);}}};fetchUserName();},[userID]);// Dependency array to prevent re-fetching if userID is already set\nreturn{userID,error};};export default HandleAuth;","map":{"version":3,"names":["useState","useEffect","decrypt","CryptoJS","HandleAuth","userID","setUserID","localStorage","getItem","error","setError","fetchUserName","encryptedToken","sessionStorage","token","apiKey","secret","paramsString","concat","apiSig","MD5","toString","url","response","fetch","ok","Error","status","data","json","session","name","set","console"],"sources":["C:/Users/jules/source/repos/jaykang98/jaze/src/utils/HandleAuth.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { decrypt } from './Encryption'; // Ensure this path is correct\r\nimport CryptoJS from 'crypto-js';\r\n\r\n// Custom hook for handling authentication\r\nconst HandleAuth = () => {\r\n    const [userID, setUserID] = useState(localStorage.getItem('userID') || null);\r\n    const [error, setError] = useState(null);\r\n\r\n    useEffect(() => {\r\n        const fetchUserName = async () => {\r\n            if (userID) return;\r\n\r\n            const encryptedToken = sessionStorage.getItem('authToken');\r\n            const token = encryptedToken ? decrypt(encryptedToken) : null;\r\n            const apiKey = '053905e1fc8b0de378dc341a24ec68c7';\r\n            const secret = 'a0c2b1ab664e5ea5ca735d57f4cdaaf8';\r\n\r\n            const paramsString = `api_key${apiKey}methodauth.getSessiontoken${token}${secret}`;\r\n            const apiSig = CryptoJS.MD5(paramsString).toString();\r\n\r\n            if (token) {\r\n                const url = `https://ws.audioscrobbler.com/2.0/?method=auth.getSession&token=${token}&api_key=${apiKey}&api_sig=${apiSig}&format=json`;\r\n\r\n                try {\r\n                    const response = await fetch(url);\r\n                    if (!response.ok) {\r\n                        throw new Error(`HTTP error! status: ${response.status}`);\r\n                    }\r\n                    const data = await response.json();\r\n\r\n                    if (data.session && data.session.name) {\r\n                        setUserID(data.session.name);\r\n                        localStorage.set(userID, data.session.name);\r\n                    }\r\n                } catch (error) {\r\n                    console.error(\"Failed to fetch session:\", error);\r\n                    setError(error);\r\n                }\r\n            }\r\n        };\r\n\r\n        fetchUserName();\r\n    }, [userID]); // Dependency array to prevent re-fetching if userID is already set\r\n\r\n    return { userID, error };\r\n};\r\n\r\nexport default HandleAuth;\r\n"],"mappings":"AAAA,OAASA,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC3C,OAASC,OAAO,KAAQ,cAAc,CAAE;AACxC,MAAO,CAAAC,QAAQ,KAAM,WAAW,CAEhC;AACA,KAAM,CAAAC,UAAU,CAAGA,CAAA,GAAM,CACrB,KAAM,CAACC,MAAM,CAAEC,SAAS,CAAC,CAAGN,QAAQ,CAACO,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,EAAI,IAAI,CAAC,CAC5E,KAAM,CAACC,KAAK,CAAEC,QAAQ,CAAC,CAAGV,QAAQ,CAAC,IAAI,CAAC,CAExCC,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAU,aAAa,CAAG,KAAAA,CAAA,GAAY,CAC9B,GAAIN,MAAM,CAAE,OAEZ,KAAM,CAAAO,cAAc,CAAGC,cAAc,CAACL,OAAO,CAAC,WAAW,CAAC,CAC1D,KAAM,CAAAM,KAAK,CAAGF,cAAc,CAAGV,OAAO,CAACU,cAAc,CAAC,CAAG,IAAI,CAC7D,KAAM,CAAAG,MAAM,CAAG,kCAAkC,CACjD,KAAM,CAAAC,MAAM,CAAG,kCAAkC,CAEjD,KAAM,CAAAC,YAAY,WAAAC,MAAA,CAAaH,MAAM,+BAAAG,MAAA,CAA6BJ,KAAK,EAAAI,MAAA,CAAGF,MAAM,CAAE,CAClF,KAAM,CAAAG,MAAM,CAAGhB,QAAQ,CAACiB,GAAG,CAACH,YAAY,CAAC,CAACI,QAAQ,CAAC,CAAC,CAEpD,GAAIP,KAAK,CAAE,CACP,KAAM,CAAAQ,GAAG,oEAAAJ,MAAA,CAAsEJ,KAAK,cAAAI,MAAA,CAAYH,MAAM,cAAAG,MAAA,CAAYC,MAAM,gBAAc,CAEtI,GAAI,CACA,KAAM,CAAAI,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAACF,GAAG,CAAC,CACjC,GAAI,CAACC,QAAQ,CAACE,EAAE,CAAE,CACd,KAAM,IAAI,CAAAC,KAAK,wBAAAR,MAAA,CAAwBK,QAAQ,CAACI,MAAM,CAAE,CAAC,CAC7D,CACA,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAL,QAAQ,CAACM,IAAI,CAAC,CAAC,CAElC,GAAID,IAAI,CAACE,OAAO,EAAIF,IAAI,CAACE,OAAO,CAACC,IAAI,CAAE,CACnCzB,SAAS,CAACsB,IAAI,CAACE,OAAO,CAACC,IAAI,CAAC,CAC5BxB,YAAY,CAACyB,GAAG,CAAC3B,MAAM,CAAEuB,IAAI,CAACE,OAAO,CAACC,IAAI,CAAC,CAC/C,CACJ,CAAE,MAAOtB,KAAK,CAAE,CACZwB,OAAO,CAACxB,KAAK,CAAC,0BAA0B,CAAEA,KAAK,CAAC,CAChDC,QAAQ,CAACD,KAAK,CAAC,CACnB,CACJ,CACJ,CAAC,CAEDE,aAAa,CAAC,CAAC,CACnB,CAAC,CAAE,CAACN,MAAM,CAAC,CAAC,CAAE;AAEd,MAAO,CAAEA,MAAM,CAAEI,KAAM,CAAC,CAC5B,CAAC,CAED,cAAe,CAAAL,UAAU"},"metadata":{},"sourceType":"module","externalDependencies":[]}